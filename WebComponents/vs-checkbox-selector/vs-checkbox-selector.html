<%@ page contentType="text/html; charset=UTF-8" %>

<dom-module id="vs-checkbox-selector">
  <style>
    :host {
      display: block;
      position: relative;
    }
    .selectBox {
      position: relative;
    }
    .selectBox select {
      width: 100%;
      font-weight: bold;
    }
    .overSelect {
      position: absolute;
      left: 0; right: 0; top: 0; bottom: 0;
    }

    .selectBox select {
      width: 100%;
      font-weight: bold;
    }
    .overSelect {
      position: absolute;
      left: 0; right: 0; top: 0; bottom: 0;
    }
    .checkboxes {
      display: none;
      border: 1px #dadada solid;
      background: #fefefe;
    }
    .checkboxes label {
      display: block;
    }
    .checkboxes label:hover {
      background-color: #dadada;
    }
  </style>
  <template>
    <div id="mainDiv" style="position: relative;">
      <div class="multiselect" style="position: absolute;">
        <div id="selectBox" class="selectBox" on-click="_showCheckboxes">
          <select class="form-control">
            <option>{{caption}}</option>
          </select>
          <div class="overSelect"></div>
        </div>
        <div id="checkboxes" class="checkboxes">
          <template is="dom-repeat" items="{{checkBoxList}}" as="item">
            <label for="{{item}}" style$="{{_getItemStyle(item)}}">
              <input id="{{item}}" type="checkbox" value="{{item}}" on-click="itemCheckboxSelected"
                                                  checked="true">{{_getItemDescription(item)}}</label>
          </template>
        </div>
      </div>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'vs-checkbox-selector',
    properties: {
      width: { type: String, value:"200px", observer:'_widthChanged'},
      caption: { type: String },
      checkBoxExpanded: { type: Boolean }
    },
    _showCheckboxes:function (e) {
      if (!this.checkBoxExpanded) {
        this.$.checkboxes.style.display = "block";
        this.checkBoxExpanded = true;
      } else {
        this.$.checkboxes.style.display = "none";
        this.checkBoxExpanded = false;
      }
    },
    init: function(checkBoxList, itemStyle, itemDescription) {
      console.log(this.tagName + "init")
      this.itemStyle = itemStyle
      this.itemDescription = itemDescription
      this.checkBoxList = checkBoxList
    },
    itemCheckboxSelected: function(e) {
      console.log(this.tagName + " - itemCheckboxSelected: " + e.model.item)
      this.fire("checkbox-selected", {value: e.model.item, checked:e.target.checked})
    },
    _widthChanged: function() {
      console.log(this.tagName + " - _widthChanged: " + this.width)
      this.$.selectBox.style.width = this.width
      this.$.mainDiv.style.width = this.width
    },
    _getItemDescription: function(item) {
      if(this.itemDescription) return this.itemDescription(item)
      else return item
    },
    _getItemStyle: function(item) {
      if(this.itemStyle ) return this.itemStyle(item)
      else return 'font-weight: bold;'
    }
  });
</script>