<link rel="import" href="../vs-i18n/vs-i18n.html">

<dom-module name="vs-user-box">
    <template>
        <style>
            .receptorsBox {
                margin: 10px auto 30px auto;
                padding: 5px 0px 0px 0px;;
                border: none;
                width:450px;
            }
            .receptorsBox legend {
                font-size: 1.2em;
                font-weight: bold;
                color:#6c0404;
            }
        </style>
        <vs-i18n id="i18nVS"></vs-i18n>
        <div hidden="{{userListHidden}}" style="border: 1px solid #ccc;padding:0px 0px 0px 10px;">
            <fieldset class="receptorsBox">
                <legend style="margin:5px 0px 0px 0px;">{{boxCaption}}</legend>
                <template is="dom-repeat" items="{{resultListDto.resultList}}">
                    <div class="layout horizontal" style="padding: 0px 10px 0px 10px;">
                        <i class="fa fa-times closeIcon" on-click="removeUser"></i>
                        <div class="flex layout vertical center-justified" style='font-size:1em;padding:0px 0 0 0px;vertical-align:middle;'>{{getUserName(item)}}</div>
                    </div>
                </template>
            </fieldset>
        </div>
    </template>
    <script>
        Polymer({
            is:'vs-user-box',
            properties: {
                userList:{type:Array, value:[], observer:'userListChanged'},
                caption:{type:String},
                multiSelection:{type:Boolean},
                messages:{type:Object}
            },
            ready:function() {
                this.messages = this.$.i18nVS.getMessages()
                this.multiSelection = this.multiSelection || true
                this.userListHidden = true
            },
            getUserName:function(user) {
                return (user.firstName != null && "" != user.firstName) ? user.firstName + " " + user.lastName:user.name
            },
            userListChanged:function() {
                this.userListHidden = (this.userList == null || this.userList.length === 0)
            },
            addUser:function(userToAdd) {
                var isNewUser = true
                if(!this.userList) this.userList = []
                for(userIdx in this.userList) {
                    if(userToAdd.id == this.userList[userIdx].id) isNewUser = false
                }
                console.log("vs-user-box - addUser: " + userToAdd.nif + " - isNewUser: " + isNewUser +
                " - multiSelection: " + this.multiSelection)
                if(isNewUser) {
                    if(!this.multiSelection) this.userList = [userToAdd]
                    else this.userList.push(userToAdd)
                }
            },
            getUserList:function(userList) {
                return this.userList
            },
            removeUser:function(e) {
                var userToDelete = e.model.item
                for(userIdx in this.userList) {
                    if(userToDelete.id == this.userList[userIdx].id) {
                        this.userList.splice(userIdx, 1)
                    }
                }
            },
            removeUsers:function(e) {
                this.userList = []
            }
        });
    </script>
</dom-module>