<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                template="/WEB-INF/templates/polymer.xhtml">
    <ui:define name="title">${msg.electionSystemLbl}</ui:define>
    <ui:define name="head">
        <link href="vs-cert.vsp" rel="import"/>
        <link href="../element/reason-dialog.vsp" rel="import"/>
    </ui:define>
    <ui:define name="content">
        <div>
            <div id="adminButtonsDiv" style="width: 600px; margin:20px auto 0px auto;">
                <c:if test="${'admin'.equals(param.menu) || 'superuser'.equals(param.menu)}">
                <button onclick="document.querySelector('#reasonDialog').show()">
                    <div>${msg.cancelCertLbl}</div>
                </button>
            </c:if>
            </div>
            <div>
                <vs-cert id="certData" certvs='#{certDto}'></vs-cert>
            </div>
        </div>

        <reason-dialog id="reasonDialog" caption="${msg.cancelCertFormCaption}"></reason-dialog>
        <script>
            sendSignalVS({caption:"${msg.trustedCertPageTitle}"})
            document.addEventListener('WebComponentsReady', function() {
                document.querySelector("#voting_system_page").addEventListener('on-submit-reason',
                        function() {
                            var operationVS = new OperationVS(Operation.CERT_EDIT)
                            operationVS.serviceURL = vs.contextURL + "/rest/certificateVS/editCert"
                            operationVS.signedMessageSubject = "${msg.cancelCertMessageSubject}"
                            var signedContent = {operation:Operation.CERT_EDIT, reason:e.detail,
                                changeCertToState:"${CertificateVS.State.CANCELED.toString()}", serialNumber:"${certMap.serialNumber}"}
                            operationVS.jsonStr = JSON.stringify(signedContent)
                            operationVS.setCallback(function() {
                                document.querySelector("#certData").url = vs.contextURL + "/rest/certificateVS/serialNumber/${certMap.serialNumber}?menu=" + menuType
                            })
                            VotingSystemClient.setMessage(operationVS);
                        }.bind(this))
            });
            <c:if test="${'CANCELED'.equals(certMap.state.toString())}">
                document.querySelector('#cancelCertButton').style.display = "none"
            </c:if>
        </script>
    </ui:define>
</ui:composition>