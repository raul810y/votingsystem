<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                template="/WEB-INF/templates/polymer.xhtml">
    <ui:define name="title">${msg.electionSystemLbl}</ui:define>
    <ui:define name="head">
        <link href="votingsystem-cert.vsp" rel="import"/>
        <link href="../element/reason-dialog.vsp" rel="import"/>
    </ui:define>
    <ui:define name="content">
        <div class="pageContentDiv">
            <div id="adminButtonsDiv" style="width: 600px; margin:20px auto 0px auto;">
                <c:if test="${'admin'.equals(param.menu) || 'superuser'.equals(param.menu)}">
                <button onclick="document.querySelector('#reasonDialog').toggle()">
                    <div>${msg.cancelCertLbl}</div>
                </button>
            </c:if>
            </div>
            <div>
                <votingsystem-cert id="certData" certvs='#{certDto}'></votingsystem-cert>
            </div>
        </div>

        <div style="position: absolute; width: 100%; top:0px;left:0px;visibility:hidden">
            <div class="layout horizontal center center-justified" style="padding:100px 0px 0px 0px;margin:0px auto 0px auto;">
                <reason-dialog id="reasonDialog" caption="${msg.cancelCertFormCaption}" opened="false" isMenuAdmin="true"></reason-dialog>
            </div>
        </div>
        <script>
            sendSignalVS({caption:"${msg.trustedCertPageTitle}"})
            document.addEventListener('WebComponentsReady', function() {
                document.querySelector("#reasonDialog").addEventListener('on-submit', function (e) {
                    var operationVS = new OperationVS(Operation.CERT_EDIT)
                    operationVS.serviceURL = contextURL + "/rest/certificateVS/editCert"
                    operationVS.signedMessageSubject = "${msg.cancelCertMessageSubject}"
                    var signedContent = {operation:Operation.CERT_EDIT, reason:e.detail,
                        changeCertToState:"${CertificateVS.State.CANCELED.toString()}", serialNumber:"${certMap.serialNumber}"}
                    operationVS.jsonStr = JSON.stringify(signedContent)
                    operationVS.setCallback(function(appMessage) {
                        document.querySelector("#certData").url = contextURL + "/rest/certificateVS/cert/" + certMap.serialNumber + "?menu=" + menuType
                    })
                    VotingSystemClient.setMessage(operationVS);
                })
            });

            <c:if test="${'CANCELED'.equals(certMap.state)}">
                document.querySelector('#cancelCertButton').style.display = "none"
            </c:if>
        </script>
    </ui:define>
</ui:composition>