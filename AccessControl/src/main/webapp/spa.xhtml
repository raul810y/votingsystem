<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/WEB-INF/templates/basic.xhtml">
    <ui:define name="head">
        <link rel="shortcut icon" type="image/png" href="./resources/images/icon_16/fa-credit-card.png" />
        <title><ui:insert name="title" /></title>
        <link href="./resources/bower_components/font-awesome/css/font-awesome.min.css" media="all" rel="stylesheet" />
        <link href="./resources/css/votingSystem.css" media="all" rel="stylesheet" />
        <script src="./resources/bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
        <link rel="import" href="./resources/bower_components/polymer/polymer.html"/>
        <link rel="import" href="./resources/bower_components/layout/layout.html"/>
        <script src="./resources/js/utils_js.vsp" type="text/javascript"></script>
        <script src="./resources/js/utils.js" type="text/javascript"></script>
        <link rel="import" href="./element/search-bar.vsp"/>
        <link rel="import" href="./resources/routing.xhtml"/>
    </ui:define>
    <ui:define name="content">
        <div id="drawer" style="display: none;">
            <div style="background-color: #ba0011; color: #f9f9f9;">
                <div id="pageTitle" style="padding: 8px 0 8px 15px;font-size: 1.5em; font-weight: bold;">${msg.appTitle}</div>
            </div>
            <div class="vertical layout flex" style="background-color: #fefefe;">
                <a class="menuItem menuItemSelected" data-route="eventElection" href="#{contextURL}/spa.xhtml#!/eventElection">
                    <i class="fa fa-envelope" style="margin:0px 10px 0px 0px;"></i> ${msg.electionSystemLbl}
                </a>
                <a class="menuItem menuItemSelected" data-route="representative" href="#{contextURL}/spa.xhtml#!/representative">
                    <i class="fa fa-hand-o-right" style="margin:0px 10px 0px 0px;"></i> ${msg.representativesPageLbl}
                </a>
                <a class="menuItem menuItemSelected" data-route="tools" href="#{contextURL}/spa.xhtml#!/app/tools">
                    <i class="fa fa-cogs" style="margin:0px 10px 0px 0px;"></i> ${msg.toolsLbl}
                </a>
                <a class="menuItem menuItemSelected" data-route="feeds" href="#{contextURL}/spa.xhtml#!/subscription/feeds">
                    <i class="fa fa-rss" style="margin:0px 10px 0px 0px;"></i> ${msg.subscriptionLbl}
                </a>
                <a class="menuItem menuItemSelected" data-route="contact" href="#{contextURL}/spa.xhtml#!/app/contact">
                    <i class="fa fa-phone" style="margin:0px 10px 0px 0px;"></i> ${msg.contactLbl}
                </a>
            </div>
        </div>
        <div id='main'>
            <div class="horizontal layout" style="background-color: #ba0011;padding: 1px 0 1px 0;box-shadow: 0 3px 3px 0 rgba(0, 0, 0, 0.24);">
                <div style="margin:0 30px 0 30px;">
                    <i id="drawerButton" class="fa fa-navicon" style="font-size: 1.7em; color: #f9f9f9;margin:3px 0 0 0; cursor: pointer;"></i>
                </div>
                <div style="font-size: 1.6em;margin:0 0 0 50px; color: #f9f9f9;" id="selectedPageTitle"></div>
                <div id="searchDiv" style="display: none;">
                    <div style="max-width: 300px; margin: 0 0 0 30px;">
                        <search-bar id="searchBar" class="horizontal layout center end-justified"></search-bar>
                    </div>
                </div>
            </div>
            <p id="pageInfoPanel" class="text-center" style="margin: 20px auto 20px auto; font-size: 1.3em;
                        background-color: #f9f9f9; max-width: 1000px; padding: 10px; display: none;"></p>

            <div id="mainContent" class="mainContent"></div>
        </div>
        <script>
            //<![CDATA[
            window.addEventListener('WebComponentsReady', function() {
                vs.back = function() {
                    history.back()
                    //there's a delay until location.href is updated with history.back()
                    setTimeout(function () {  page(window.location.href.split("\\#!")[1]) }, 50);
                }

                document.querySelector("#drawerButton").addEventListener('click', function (event) {
                    document.querySelector("#drawer").style.display = 'block'
                    event.stopPropagation();
                }, true);

                document.querySelector("#voting_system_page").addEventListener('click', function (event) {
                    document.querySelector("#drawer").style.display = 'none'
                });

                vs.loadMainContent = function(newContentNode, caption, searchVisible) {
                    if(caption) sendSignalVS({caption:caption})
                    var mainContentNode = document.getElementById("mainContent")
                    if(mainContentNode.childNodes[0]) mainContentNode.removeChild(mainContentNode.childNodes[0])
                    mainContentNode.appendChild(newContentNode)
                    if(searchVisible === true) document.querySelector("#searchDiv").style.display = 'block';
                    else document.querySelector("#searchDiv").style.display = 'none';
                    var menuItems = document.querySelectorAll("#drawer .menuItem")
                    for(var i = 0; i < menuItems.length ; i++) {
                        if(menuItems[i].getAttribute("data-route") === vs.route) {
                            menuItems[i].classList.add("menuItemSelected");
                        } else menuItems[i].classList.remove("menuItemSelected");
                    }
                }

                vs.updateSearchMessage = function(searchMessage) {
                    if(searchMessage) {
                        document.querySelector("#pageInfoPanel").innerHTML = searchMessage
                        document.querySelector("#pageInfoPanel").style.display = "block"
                    } else document.querySelector("#pageInfoPanel").style.display = "none"
                }

                document.querySelector('#voting_system_page').addEventListener('search-request', function (e) {
                    console.log("spa.xhtml - search request - query:" + e.detail.query);
                })

            })
            //]]>
        </script>
    </ui:define>
</ui:composition>