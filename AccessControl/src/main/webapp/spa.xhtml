<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/WEB-INF/templates/basic.xhtml">
  <ui:define name="head">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="mobile-web-app-capable" content="yes"/>
    <meta name="application-name" content="VotingSystem"/>
    <link rel="shortcut icon" type="image/png" href="./resources/images/icon_16/fa-credit-card.png" />
    <title><ui:insert name="title" /></title>
    <h:outputStylesheet name="css/votingSystem.css" />
    <script src="./resources/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="./resources/js/utilsVS.js" type="text/javascript"></script>
    <script src="./resources/js/utils_js.vsp" type="text/javascript"></script>
    <link rel="import" href="./resources/elements.html"/>
  </ui:define>
  <ui:define name="content">
    <div class="fullbleed layout vertical">
        <template is="dom-bind" id="app">
            <paper-drawer-panel id="paperDrawerPanel" force-narrow="true">
                <paper-scroll-header-panel drawer="" fixed="">
                    <paper-toolbar id="drawerToolbar">
                        <div class="center horizontal layout flex">
                            <div class="app-name">{{appTitle}}</div>
                        </div>
                    </paper-toolbar>
                    <paper-menu class="list drawerToolbar" attr-for-selected="data-route" selected="[[route]]">
                        <a hidden="{{!adminMenuHidden}}" data-route="eventVSElection" href="#{contextURL}/spa.xhtml#!/eventVSElection" on-click="onDataRouteClick">
                            <i class="fa fa-envelope" style="margin:0px 10px 0px 0px;"></i> ${msg.electionSystemLbl}
                        </a>
                        <a hidden="{{!adminMenuHidden}}" data-route="representative" href="#{contextURL}/spa.xhtml#!/representative" on-click="onDataRouteClick">
                            <i class="fa fa-hand-o-right" style="margin:0px 10px 0px 0px;"></i> ${msg.representativesPageLbl}
                        </a>
                        <a hidden="{{clientToolConnected}}" data-route="tools" href="#{contextURL}/spa.xhtml#!/app/tools" on-click="onDataRouteClick">
                            <i class="fa fa-cogs" style="margin:0px 10px 0px 0px;"></i> ${msg.toolsLbl}
                        </a>
                        <div hidden="{{clientToolConnected}}">
                            <a hidden="{{!adminMenuHidden}}" data-route="feeds" href="#{contextURL}/spa.xhtml#!/subscriptionVS/feeds" on-click="onDataRouteClick">
                                <i class="fa fa-rss" style="margin:0px 10px 0px 0px;"></i> ${msg.subscriptionLbl}
                            </a>
                        </div>
                        <a hidden="{{!adminMenuHidden}}" data-route="contact" href="#{contextURL}/spa.xhtml#!/app/contact" on-click="onDataRouteClick">
                            <i class="fa fa-phone" style="margin:0px 10px 0px 0px;"></i> ${msg.contactLbl}
                        </a>
                        <a hidden="{{adminMenuHidden}}" data-route="publish_election" href="/publish_election" on-click="onDataRouteClick">
                            <i class="fa fa-envelope" style="margin:0px 10px 0px 0px;"></i> ${msg.publishVoteLbl}
                        </a>
                        <a hidden="{{adminMenuHidden}}" data-route="new_representative" href="/new_representative" on-click="onDataRouteClick">
                            <i class="fa fa-hand-o-right" style="margin:0px 10px 0px 0px;"></i> ${msg.newRepresentativeLbl}
                        </a>
                        <a hidden="{{adminMenuHidden}}" data-route="edit_representative" href="/representative/edit" on-click="onDataRouteClick">
                            <i class="fa fa-hand-o-right" style="margin:0px 10px 0px 0px;"></i> ${msg.editRepresentativeLbl}
                        </a>

                    </paper-menu>
                </paper-scroll-header-panel>
                <div main="" >
                    <div class="horizontal layout" style="margin:1px 0 0 0;">
                        <div style="margin:0 30px 0 30px;">
                            <i paper-drawer-toggle="" class="fa fa-navicon" style="font-size: 1.4em; color: #ba0011; cursor: pointer;" ></i>
                        </div>
                        <div id="searchDiv" hidden="{{searchHidden}}" style="display: none;">
                            <div style="max-width: 300px;">
                                <search-bar id="appBar" class="horizontal layout center end-justified"
                                            on-search-request="performSearch"></search-bar>
                            </div>
                        </div>
                    </div>
                    <p id="pageInfoPanel" class="text-center" style="margin: 20px auto 20px auto; font-size: 1.3em;
                        background-color: #f9f9f9; max-width: 1000px; padding: 10px; display: none;"></p>

                    <div id="mainContent" class="mainContent"></div>
                </div>
            </paper-drawer-panel>
            <h:messages styleClass="messages"
                        style="list-style: none; padding:0; margin:0;"
                        errorClass="alert alert-error" infoClass="alert alert-success"
                        warnClass="alert alert-warning" globalOnly="true"/>
        </template>
        <alert-dialog id="_votingsystemMessageDialog"></alert-dialog>
        <iron-signals id="ironSignals"></iron-signals>
    </div>
    <script>
        (function(document) {
            var app = document.querySelector('#app');

            app.addEventListener('dom-change', function() {
                console.log('spa.xhtml - dom-change');
                app.searchHidden = true
            });

            window.addEventListener('WebComponentsReady', function() {
                console.log('spa.xhtml - WebComponentsReady - app.route: ' + app.route);
                if (checkIfClientToolIsConnected()) {
                    app.clientToolConnected = true
                }
            });

            app.back = function() {
                history.back()
                //there's a delay until location.href is updated with history.back()
                setTimeout(function () {
                    page(window.location.href.split("\\#!")[1])
                }, 50);
            }

            app.onDataRouteClick = function() {
                var drawerPanel = document.querySelector('#paperDrawerPanel');
                if (drawerPanel.narrow) {
                    drawerPanel.closeDrawer();
                }
            };

            app.loadMainContent = function(newContentNode, caption, searchVisible) {
                var mainContentNode = document.querySelector('paper-drawer-panel').querySelector('#mainContent')
                var beforeContentNode = Polymer.dom(mainContentNode).childNodes[0]
                if(beforeContentNode) Polymer.dom(mainContentNode).removeChild(beforeContentNode)
                Polymer.dom(mainContentNode).appendChild(newContentNode)
                if('admin' === menuType) caption = caption + ' - ${msg.adminLbl}'
                if('superuser' === menuType) caption = caption + ' - ${msg.superUserLbl}'
                if(caption) sendSignalVS({caption:caption})
                if(searchVisible === true) app.searchHidden = false
                else app.searchHidden = true
            }

            app.updateMenuView = function() {
                app.appTitle = "${msg.appTitle}"
                app.adminMenuHidden = true;
                if('admin' === menuType) {
                    app.adminMenuHidden = false;
                    app.appTitle = app.appTitle + " - ${msg.adminPageTitle}"
                }
            }

            app.updateSearchMessage = function(searchMessage) {
                if(searchMessage) {
                    document.querySelector("#pageInfoPanel").innerHTML = searchMessage
                    document.querySelector("#pageInfoPanel").style.display = "block"
                } else document.querySelector("#pageInfoPanel").style.display = "none"
            }

            app.scrollPageToTop = function() {
                document.getElementById('mainContainer').scrollTop = 0;
            };

            app.updateMenuView()
        })(document);
    </script>
  </ui:define>
</ui:composition>