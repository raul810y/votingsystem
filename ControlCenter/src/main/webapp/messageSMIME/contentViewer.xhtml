<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/WEB-INF/templates/polymer.xhtml">
    <ui:define name="head">
        <title>${msg.signedDocumentLbl}</title>
        <link href="${viewer}.vsp" rel="import"/>
    </ui:define>
    <ui:define name="content">
        <div class="horizontal layout" style="margin:1px 0 0 0;">
            <div style="font-size: 1.3em;margin:0 0 0 50px; color: #888;text-decoration: underline;" id="selectedPageTitle"></div>
        </div>

        <div id="smimeMessage" style="display:none;">${smimeMessage}</div>

        <script>
            var timeStampDate = new Date(${timeStampDate}).getDayWeekAndHourFormat()
            var viewer = null
            var smimeMessageContent = toJSON('${signedContentMap}')

            document.addEventListener('WebComponentsReady', function() {
                console.log("receiptViewer - WebComponentsReady - viewer: ${viewer}")
                viewer = document.createElement('${viewer}');
                sendSignalVS({caption:"${msg.signedDocumentLbl}"})
                document.querySelector("#voting_system_page").appendChild(viewer)
                loadContent()
            });

            function showContent(contentStr, timeStampDateStr) {
                var b64_to_utf8 = decodeURIComponent(escape(window.atob(contentStr)))
                smimeMessageContent = JSON.parse(b64_to_utf8)
                timeStampDate = timeStampDateStr
                if(viewer != null) loadContent()
            }

            function loadContent() {
                viewer.smimeMessage = document.querySelector("#smimeMessage").innerHTML;
                viewer.smimeMessageContent = smimeMessageContent
                viewer.timeStampDate = timeStampDate
                smimeMessageContent = null
                timeStampDate = null
            }
        </script>
    </ui:define>
</ui:composition>
