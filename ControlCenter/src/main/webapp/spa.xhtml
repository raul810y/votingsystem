<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/WEB-INF/templates/basic.xhtml">
  <ui:define name="head">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="mobile-web-app-capable" content="yes"/>
    <meta name="application-name" content="VotingSystem"/>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="shortcut icon" type="image/png" href="./resources/images/icon_16/fa-bolt.png" />
    <title><ui:insert name="title" /></title>
    <h:outputStylesheet name="css/votingSystem.css" />
    <script src="./resources/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="./resources/js/utilsVS.js" type="text/javascript"></script>
    <script src="./resources/js/utils_js.vsp" type="text/javascript"></script>
    <link rel="import" href="./resources/elements.html"/>
  </ui:define>
  <ui:define name="content">
    <div class="fullbleed layout vertical">
        <template is="dom-bind" id="app">
            <paper-drawer-panel id="paperDrawerPanel" force-narrow="true">
                <paper-scroll-header-panel drawer="" fixed="">
                    <paper-toolbar id="drawerToolbar">
                        <div class="center horizontal layout flex">
                            <div class="app-name">{{appTitle}}</div>
                        </div>
                    </paper-toolbar>
                    <paper-menu class="list drawerToolbar" attr-for-selected="data-route" selected="[[route]]">
                        <a hidden="{{!adminMenuHidden}}" data-route="eventVSElection" href="#{contextURL}/spa.xhtml#!/eventVSElection" on-click="onDataRouteClick">
                            <i class="fa fa-envelope" style="margin:0px 10px 0px 0px;"></i> ${msg.electionSystemLbl}
                        </a>
                        <a data-route="feeds" href="#{contextURL}/spa.xhtml#!/subscriptionVS/feeds" on-click="onDataRouteClick">
                            <i class="fa fa-rss" style="margin:0px 10px 0px 0px;"></i> ${msg.subscriptionLbl}
                        </a>
                        <a data-route="contact" href="#{contextURL}/spa.xhtml#!/app/contact" on-click="onDataRouteClick">
                            <i class="fa fa-phone" style="margin:0px 10px 0px 0px;"></i> ${msg.contactLbl}
                        </a>
                    </paper-menu>
                </paper-scroll-header-panel>
                <div main="" >
                    <div class="horizontal layout" style="margin:1px 0 0 0;">
                        <div style="margin:0 30px 0 30px;">
                            <i paper-drawer-toggle="" class="fa fa-navicon" style="font-size: 1.4em; color: #ba0011; cursor: pointer;" ></i>
                        </div>
                        <div id="searchDiv" hidden="{{searchHidden}}" style="display: none;">
                            <div style="max-width: 300px;">
                                <search-bar id="appBar" class="horizontal layout center end-justified"
                                            on-search-request="performSearch"></search-bar>
                            </div>
                        </div>
                    </div>
                    <p id="pageInfoPanel" class="text-center" style="margin: 20px auto 20px auto; font-size: 1.3em;
                        background-color: #f9f9f9; max-width: 1000px; padding: 10px; display: none;"></p>

                    <div id="mainContent" class="mainContent"></div>
                </div>

            </paper-drawer-panel>
            <h:messages styleClass="messages"
                        style="list-style: none; padding:0; margin:0;"
                        errorClass="alert alert-error" infoClass="alert alert-success"
                        warnClass="alert alert-warning" globalOnly="true"/>
        </template>
        <alert-dialog id="_votingsystemMessageDialog"></alert-dialog>
        <iron-signals id="ironSignals"></iron-signals>
    </div>
    <script>
        (function(document) {
            var app = document.querySelector('#app');

            app.addEventListener('dom-change', function() {
                console.log('spa.xhtml - dom-change');
                app.searchHidden = true
                app.appTitle = "${msg.appTitle}"
            });

            window.addEventListener('WebComponentsReady', function() {
                console.log('spa.xhtml - WebComponentsReady - app.route: ' + app.route);
            });

            app.back = function() {
                history.back()
                //there's a delay until location.href is updated with history.back()
                setTimeout(function () {
                    page(window.location.href.split("\\#!")[1])
                }, 50);
            }

            app.onDataRouteClick = function() {
                var drawerPanel = document.querySelector('#paperDrawerPanel');
                if (drawerPanel.narrow) {
                    drawerPanel.closeDrawer();
                }
            };

            app.loadMainContent = function(newContentNode, caption, searchVisible) {
                var mainContentNode = document.querySelector('paper-drawer-panel').querySelector('#mainContent')
                var beforeContentNode = Polymer.dom(mainContentNode).childNodes[0]
                if(beforeContentNode) Polymer.dom(mainContentNode).removeChild(beforeContentNode)
                Polymer.dom(mainContentNode).appendChild(newContentNode)
                if(caption) sendSignalVS({caption:caption})
                if(searchVisible === true) app.searchHidden = false
                else app.searchHidden = true
            }

            app.updateSearchMessage = function(searchMessage) {
                if(searchMessage) {
                    document.querySelector("#pageInfoPanel").innerHTML = searchMessage
                    document.querySelector("#pageInfoPanel").style.display = "block"
                } else document.querySelector("#pageInfoPanel").style.display = "none"
            }

            app.scrollPageToTop = function() {
                document.getElementById('mainContainer').scrollTop = 0;
            };
        })(document);
    </script>
  </ui:define>
</ui:composition>