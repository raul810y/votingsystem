<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/WEB-INF/templates/basic.xhtml">
  <ui:define name="head">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="mobile-web-app-capable" content="yes"/>
    <meta name="application-name" content="VotingSystem"/>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="shortcut icon" type="image/png" href="./resources/images/icon_16/fa-money.png" />
    <title><ui:insert name="title" /></title>
    <h:outputStylesheet name="css/currency.css" />
    <script src="./resources/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="./resources/js/utilsVS.js" type="text/javascript"></script>
    <script src="./resources/js/utils_js.vsp" type="text/javascript"></script>

    <link rel="import" href="./resources/elements.html"/>
    <link rel="import" href="./element/search-bar.vsp"/>
  </ui:define>
  <ui:define name="content">
    <div class="fullbleed layout vertical">
        <template is="dom-bind" id="app">
            <paper-drawer-panel id="paperDrawerPanel">
                <paper-scroll-header-panel drawer="" fixed="">
                    <paper-toolbar class="drawerToolbar">
                    </paper-toolbar>
                    <paper-menu class="list drawerToolbar" attr-for-selected="data-route" selected="[[route]]">
                        <a data-route="groupVS" href="#{contextURL}/spa.xhtml#!/groupVS" on-click="onDataRouteClick">
                            <i class="fa fa-users" style="margin:0px 10px 0px 0px;"></i> ${msg.selectGroupvsLbl}
                        </a>
                        <a data-route="userVSDashboard" href="#{contextURL}/spa.xhtml#!/app/userVSDashboard" on-click="onDataRouteClick">
                            <i class="fa fa-tachometer" style="margin:0px 10px 0px 0px;"></i> ${msg.dashBoardLbl}
                        </a>
                        <a data-route="userVS" href="#{contextURL}/spa.xhtml#!/userVS/search" on-click="onDataRouteClick">
                            <i class="fa fa-user" style="margin:0px 10px 0px 0px;"></i> ${msg.locateUserVSLbl}
                        </a>
                        <a data-route="currencyRequest" href="#{contextURL}/spa.xhtml#!/currency/request" on-click="onDataRouteClick">
                            <i class="fa fa-money" style="margin:0px 10px 0px 0px;"></i> ${msg.doCurrencyRequestLbl}
                        </a>
                        <a hidden="{{!isAdminView}}" data-route="newGroupVS" href="#{contextURL}/spa.xhtml#!/newGroupVS" on-click="onDataRouteClick">
                            <i class="fa fa-users" style="margin:0px 10px 0px 0px;"></i> ${msg.newGroupVSLbl}
                        </a>
                        <a hidden="{{!isSuperUserView}}" data-route="newGroupVS" href="#{contextURL}/spa.xhtml#!/userVS/newBankVS" on-click="onDataRouteClick">
                            <i class="fa fa-university" style="margin:0px 10px 0px 0px;"></i> ${msg.newBankVSLbl}
                        </a>
                        <a hidden="{{!isSuperUserView}}" data-route="certificateVS" href="/#{contextURL}/spa.xhtml#!certificateVS/certs" on-click="onDataRouteClick">
                            <i class="fa fa-users" style="margin:0px 10px 0px 0px;"></i> ${msg.locateCertLbl}
                        </a>
                        <a data-route="reports" href="#{contextURL}/spa.xhtml#!/reports" on-click="onDataRouteClick">
                            <i class="fa fa-list-alt" style="margin:0px 10px 0px 0px;"></i> ${msg.reportsPageTitle}
                        </a>
                        <a data-route="docs" href="#{contextURL}/spa.xhtml#!/innerVSPage?url=/app/index.xhtml&amp;caption=${msg.docsLbl}" on-click="onDataRouteClick">
                            <i class="fa fa-info" style="margin:0px 10px 0px 0px;"></i> ${msg.docsLbl}
                        </a>
                        <a data-route="contact" href="#{contextURL}/spa.xhtml#!/innerVSPage?url=/app/contact.xhtml&amp;caption=${msg.contactLbl}" on-click="onDataRouteClick">
                            <i class="fa fa-phone" style="margin:0px 10px 0px 0px;"></i> ${msg.contactLbl}
                        </a>
                    </paper-menu>
                </paper-scroll-header-panel>

                <paper-header-panel main="" condenses="" keep-condensed-header="">
                    <paper-toolbar id="mainToolbar" >
                        <div style="margin: 0 12px 0 0;">
                            <iron-icon paper-drawer-toggle="" icon="icons:menu" style="margin: 0 10px 0 10px;"
                                       class="vs-navbar-icon"></iron-icon>
                        </div>
                        <div class="center horizontal layout flex">
                            <div class="app-name">{{appTitle}}</div>
                        </div>
                        <div hidden="{{searchHidden}}">
                            <search-bar id="appBar" class="horizontal layout center end-justified"
                                     on-search-request="performSearch"></search-bar>
                        </div>
                    </paper-toolbar>

                    <p id="pageInfoPanel" class="text-center" style="margin: 20px auto 20px auto; font-size: 1.3em;
                        background-color: #f9f9f9; max-width: 1000px; padding: 10px; display: none;"></p>

                    <div id="mainContent" class="mainContent"></div>
                </paper-header-panel>

            </paper-drawer-panel>
            <h:messages styleClass="messages"
                        style="list-style: none; padding:0; margin:0;"
                        errorClass="alert alert-error" infoClass="alert alert-success"
                        warnClass="alert alert-warning" globalOnly="true"/>
        </template>
        <alert-dialog id="_votingsystemMessageDialog"></alert-dialog>
        <iron-signals id="ironSignals"></iron-signals>
    </div>
    <script>
        (function(document) {
            var app = document.querySelector('#app');

            app.addEventListener('dom-change', function() {
                console.log('spa.xhtml - dom-change');
                app.searchHidden = true
            });

            window.addEventListener('WebComponentsReady', function() {
                console.log('spa.xhtml - WebComponentsReady');
            });

            app.back = function() {
                history.back()
                //there's a delay until location.href is updated with history.back()
                setTimeout(function () {
                    page(window.location.href.split("\\#!")[1])
                }, 50);
            }

            app.onDataRouteClick = function() {
                var drawerPanel = document.querySelector('#paperDrawerPanel');
                if (drawerPanel.narrow) {
                    drawerPanel.closeDrawer();
                }
            };

            app.loadMainContent = function(newContentNode, caption, searchVisible) {
                var mainContentNode = document.querySelector('paper-drawer-panel').querySelector('#mainContent')
                var beforeContentNode = Polymer.dom(mainContentNode).childNodes[0]
                if(beforeContentNode) Polymer.dom(mainContentNode).removeChild(beforeContentNode)
                Polymer.dom(mainContentNode).appendChild(newContentNode)
                if('admin' === menuType) caption = caption + ' - ${msg.adminLbl}'
                if('superuser' === menuType) caption = caption + ' - ${msg.superUserLbl}'
                if(caption) sendSignalVS({caption:caption})
                if(searchVisible === true) app.searchHidden = false
                else app.searchHidden = true
            }

            app.updateMenuView = function() {
                app.appTitle = "${msg.appTitle}"
                app.isAdminView = false;
                app.isSuperUserView = false;
                app.isUserView = false;
                if('admin' === menuType) {
                    app.isAdminView = true;
                    app.appTitle = app.appTitle + " - ${msg.adminPageTitle}"
                } else if('superuser' === menuType) {
                    this.isSuperUserView = true;
                    app.appTitle = app.appTitle + " - ${msg.superUserTitle}"
                } else {
                    this.isUserView = true;
                }
            }

            app.updateSearchMessage = function(searchMessage) {
                if(searchMessage) {
                    document.querySelector("#pageInfoPanel").innerHTML = searchMessage
                    document.querySelector("#pageInfoPanel").style.display = "block"
                } else document.querySelector("#pageInfoPanel").style.display = "none"
            }

            app.performSearch = function(e) {
                console.log("app.performSearch - query: " + e.detail.query )
            }

            document.querySelector("#voting_system_page").addEventListener('user-clicked', function(e) {
                console.log("spa.xhtml - user-clicked")
                page.show(contextURL + "/rest/userVS/id/" + e.detail.id)
            })

            app.scrollPageToTop = function() {
                document.getElementById('mainContainer').scrollTop = 0;
            };

            app.updateMenuView()
        })(document);
    </script>
  </ui:define>
</ui:composition>