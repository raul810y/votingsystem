<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/WEB-INF/templates/basic.xhtml">
    <ui:define name="head">
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <meta name="mobile-web-app-capable" content="yes"/>
        <meta name="application-name" content="VotingSystem"/>
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <link rel="shortcut icon" type="image/png" href="./resources/images/icon_16/fa-money.png" />
        <title><ui:insert name="title" /></title>
        <link href="./resources/bower_components/font-awesome/css/font-awesome.min.css" media="all" rel="stylesheet" />
        <link href="./resources/css/currency.css" media="all" rel="stylesheet" />
        <script src="./resources/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
        <link href="./resources/bower_components/polymer/polymer.html" rel="import"/>
        <link rel="import" href="./resources/bower_components/iron-flex-layout/classes/iron-flex-layout.html"/>
        <script src="./resources/js/utilsVS.js" type="text/javascript"></script>
        <script src="./resources/js/utils_js.vsp" type="text/javascript"></script>
        <link href="./resources/d3.html" rel="import"/>
        <link rel="import" href="./element/search-bar.vsp"/>
        <link rel="import" href="./resources/routing.xhtml"/>
    </ui:define>
    <ui:define name="content">
        <div id="drawer" style="display: none;">
            <div style="background-color: #ba0011; color: #f9f9f9;">
                <div id="pageTitle" class="app-name" style="padding: 8px 0 8px 15px;font-size: 2em; font-weight: bold;"></div>
            </div>
            <div class="vertical layout flex" style="background-color: #fefefe;">
                <a class="menuItem menuItemSelected" data-route="groupVS" href="#{contextURL}/spa.xhtml#!/groupVS">
                    <i class="fa fa-users" style="margin:0px 10px 0px 0px;"></i> ${msg.selectGroupvsLbl}
                </a>
                <a class="menuItem menuItemSelected" data-route="transactionsDashboard" href="#{contextURL}/spa.xhtml#!/transactionsDashboard">
                    <i class="fa fa-tachometer" style="margin:0px 10px 0px 0px;"></i> ${msg.dashBoardLbl}
                </a>
                <a class="menuItem menuItemSelected" data-route="userVS" href="#{contextURL}/spa.xhtml#!/userVS/search">
                    <i class="fa fa-user" style="margin:0px 10px 0px 0px;"></i> ${msg.locateUserVSLbl}
                </a>
                <a class="menuItem menuItemSelected" data-route="currencyRequest" href="#{contextURL}/spa.xhtml#!/currency/request">
                    <i class="fa fa-money" style="margin:0px 10px 0px 0px;"></i> ${msg.doCurrencyRequestLbl}
                </a>
                <a class="menuItem menuItemSelected isAdminView" data-route="newGroupVS" href="#{contextURL}/spa.xhtml#!/newGroupVS">
                    <i class="fa fa-users" style="margin:0px 10px 0px 0px;"></i> ${msg.newGroupVSLbl}
                </a>
                <a class="menuItem menuItemSelected isSuperUserView" data-route="newBankVS" href="#{contextURL}/spa.xhtml#!/innerVSPage?url=/userVS/newBankVS.xhtml&amp;caption=${msg.newBankVSLbl}&amp;data_route=newBankVS">
                    <i class="fa fa-university" style="margin:0px 10px 0px 0px;"></i> ${msg.newBankVSLbl}
                </a>
                <a class="menuItem menuItemSelected isSuperUserView" data-route="certificateVS" href="#{contextURL}/spa.xhtml#!/certificateVS/certs">
                    <i class="fa fa-users" style="margin:0px 10px 0px 0px;"></i> ${msg.locateCertLbl}
                </a>
                <a class="menuItem menuItemSelected" data-route="reports" href="#{contextURL}/spa.xhtml#!/reports">
                    <i class="fa fa-list-alt" style="margin:0px 10px 0px 0px;"></i> ${msg.reportsPageTitle}
                </a>
                <a class="menuItem menuItemSelected" data-route="docs" href="#{contextURL}/spa.xhtml#!/innerVSPage?url=/app/index.xhtml&amp;caption=${msg.docsLbl}&amp;data_route=docs">
                    <i class="fa fa-info" style="margin:0px 10px 0px 0px;"></i> ${msg.docsLbl}
                </a>
                <a class="menuItem menuItemSelected" data-route="contact" href="#{contextURL}/spa.xhtml#!/innerVSPage?url=/app/contact.xhtml&amp;caption=${msg.contactLbl}">
                    <i class="fa fa-phone" style="margin:0px 10px 0px 0px;"></i> ${msg.contactLbl}
                </a>
            </div>
        </div>
        <div id='main'>
            <div class="horizontal layout" style="margin:1px 0 0 0;">
                <div style="margin:0 30px 0 30px;">
                    <i id="drawerButton" class="fa fa-navicon" style="font-size: 1.7em; color: #ba0011; cursor: pointer;"></i>
                </div>
                <div id="searchDiv" style="display: none;">
                    <div style="max-width: 300px;">
                        <search-bar id="searchBar" class="horizontal layout center end-justified"></search-bar>
                    </div>
                </div>
                <div style="font-size: 1.3em;margin:0 0 0 50px; color: #888;text-decoration: underline;" id="selectedPageTitle"></div>
            </div>

            <p id="pageInfoPanel" class="text-center" style="margin: 20px auto 20px auto; font-size: 1.3em;
                        background-color: #f9f9f9; max-width: 1000px; padding: 10px; display: none;"></p>

            <div id="mainContent" class="mainContent"></div>
        </div>
        <script>
            //debugger; // this is to allow logging from extension content scripts

            vs.back = function() {
                history.back()
                //there's a delay until location.href is updated with history.back()
                setTimeout(function () {
                    page(window.location.href.split("\\#!")[1])
                }, 50);
            }

            d3.select("#drawerButton").on("click", function(e) {
                d3.select("#drawer").style({display:'block'});
                d3.event.stopPropagation();
            })

            d3.select("#voting_system_page").on('click', function(d, i) {
                d3.select("#drawer").style({display:'none'});
            })

            vs.updateMenuView = function() {
                var appTitle = "${msg.appTitle}"
                d3.selectAll(".isAdminView").style("display", "none")
                d3.selectAll(".isSuperUserView").style("display", "none")
                if('admin' === menuType) {
                    d3.select(".isAdminView").style("display", "block")
                    appTitle = "${msg.adminPageTitle}"
                } else if('superuser' === menuType) {
                    d3.select(".isSuperUserView").style("display", "block")
                    appTitle = "${msg.superUserTitle}"
                }
                d3.select("#pageTitle").text(appTitle)
            }

            vs.loadMainContent = function(newContentNode, caption, searchVisible) {
                if(caption) sendSignalVS({caption:caption})
                var mainContentNode = document.getElementById("mainContent")
                if(mainContentNode.childNodes[0]) mainContentNode.removeChild(mainContentNode.childNodes[0])
                mainContentNode.appendChild(newContentNode)
                if('admin' === menuType) caption = caption + ' - ${msg.adminLbl}'
                if('superuser' === menuType) caption = caption + ' - ${msg.superUserLbl}'
                if(searchVisible === true) d3.select("#searchDiv").style("display", "block")
                else d3.select("#searchDiv").style("display", "none")
                d3.selectAll("#drawer .menuItem").each( function(d) {
                    if(d3.select(this).attr("data-route") === vs.route){
                        d3.select(this).classed("menuItemSelected", true)
                    } else d3.select(this).classed("menuItemSelected", false)
                })
            }

            vs.updateSearchMessage = function(searchMessage) {
                if(searchMessage) {
                    document.querySelector("#pageInfoPanel").innerHTML = searchMessage
                    document.querySelector("#pageInfoPanel").style.display = "block"
                } else document.querySelector("#pageInfoPanel").style.display = "none"
            }

            vs.scrollPageToTop = function() {
                document.getElementById('mainContent').scrollTop = 0;
            };

            document.querySelector('#voting_system_page').addEventListener('search-request', function (e) {
                console.log("spa.xhtml - search request - query:" + e.detail.query);
            })

            document.querySelector("#voting_system_page").addEventListener('user-clicked', function(e) {
                console.log("spa.xhtml - user-clicked")
                page.show(contextURL + "/rest/userVS/id/" + e.detail.id)
            })

            vs.performSearch = function(e) {
                console.log("vs.performSearch - query: " + e.detail.query )
            }

            vs.updateMenuView()

        </script>
    </ui:define>
</ui:composition>