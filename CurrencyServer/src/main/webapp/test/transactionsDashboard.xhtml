<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/WEB-INF/templates/basic.xhtml">
    <ui:define name="head">
        <title>${msg.dashBoardLbl}</title>
        <link href="../resources/css/currency.css" media="all" rel="stylesheet" />
        <script src="../resources/js/utilsVS.js" type="text/javascript"></script>
        <script type="text/javascript" src="../resources/bower_components/d3/d3.js"></script>
        <script type="text/javascript" src="TransactionsLegend.js"></script>
        <script type="text/javascript" src="TransactionsScatterPlot.js"></script>
        <script type="text/javascript" src="TransactionStats.js"></script>

        <link href="transactions-scatter.css" rel="stylesheet" type="text/css"/>
    </ui:define>
    <ui:define name="content">
        <button id="scatterPlotResetButton" style="position: absolute;">reset</button>
        <div id="scatterPlotDiv" style="width: 100%; height: 500px;"></div>
        <script>
            //<![CDATA[
            var scatterPlot, resultList, transactionsStats = new TransactionsStats()
            getData("/CurrencyServer/rest/transactionVS/from/20151116_0000/to/20151118_0000")

            function getData(url) {
                d3.json(url, function (json) {
                    resultList = json.resultList
                    resultList.forEach(function(transactionvs) {
                        transactionsStats.pushTransaction(transactionvs)
                    })
                    printScatterChart(resultList)
                })
            }

            function printScatterChart(data) {
                scatterPlot = TransactionsScatterChart().transactionsStats(transactionsStats)
                        .resetButton(document.getElementById("scatterPlotResetButton"))
                        .margin({top: 40, right: 10, bottom: 100, left: 50})
                        .containerDiv(document.getElementById("scatterPlotDiv"))
                        .yAxis.label('${amountLbl}');
                var svg = d3.select("#scatterPlotDiv").append("svg")
                        .attr('width', scatterPlot.width())
                        .attr('height', scatterPlot.height()).datum(data)
                svg.transition().duration(500).call(scatterPlot);
            }

            window.addEventListener('resize', function(event){
                console.log("resize")
                var scatterPlotDiv = document.getElementById("scatterPlotDiv")
                while (scatterPlotDiv.hasChildNodes()) {
                    scatterPlotDiv.removeChild(scatterPlotDiv.lastChild);
                }
                printScatterChart(resultList)
            });
            //]]>
        </script>
    </ui:define>
</ui:composition>