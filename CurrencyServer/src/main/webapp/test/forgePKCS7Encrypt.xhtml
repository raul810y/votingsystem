<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/WEB-INF/templates/polymer.xhtml">
    <ui:define name="head">
        <link href="../resources/forgePKCS7.html" rel="import"/>
        <style></style>
    </ui:define>
    <ui:define name="content">
        <h3><div id="selectedMsgDiv"></div></h3>
        <div id="oids"></div>
        <div id="privateKey" style="display:none;">
            -----BEGIN RSA PRIVATE KEY-----
            MIICXAIBAAKBgQDAsXrYoW/33Kb5+9dbKyAQot+jvFOe3h3bpg5QItZEfCACUHl6
            Koz0KBnjRMFYG+7F4jKRtJmq4xgIapXfdBLZ0xQTdZ3qIYSWJ7t51m62jkKAg7cv
            +g+sa/599Lk/xYclArZ+5TaJ8h3mbPrUCEv5w7FR38XxDQXlvY/q1r6t9QIDAQAB
            AoGAfpUYii6jC0RcPGQAONe/nK4iE8GnfPmUy7HuPR5le1++90Y+Rs6lAc9GElIc
            YPEYjc3mQmlNeUDtjLnX8o6hwmpC0PCZZps0lM3ZMFuSwsRfpNPGFtoj/BQ7Xq2s
            zp9XOdXzdhbsa8u1jUJxfglxU+GFmaurWDn1x7MVcaf/UJECQQDk2c2yiqikmOPZ
            M6MowXktqGoTrTXMKD9k5H86/kvKr09JCDfqlRr97KX8NcLqQ6L2aqfGZs94aBh4
            7e+wO41LAkEA142Sr9GvTPNnIZCUE0rTlgJUvAoCXCxRgcnwx/sNZ8SuSFAWcWw1
            s8ATdnY9aWNJJ++16a0fmT4aqPOtxMXpvwJAeiTxz+CIAEoGGnCgHemdpsvjyhrB
            wvScWVpHuhHuHAETvTQgvBjXLj43nXSIUwbEnObyI0fOZkKRBUJhkttGHwJAdQAm
            kAK8KYOxBhoJFhO2l6U6QzsXntp7f3ySkqol056Bj0TRec1ntOLcbZ+uo+a9jczi
            rC1Jio+YPv7N4pIe1wJBAApuHhHKXO4MWmcZao+BJ8j1tzjF7GoQ/szHY7SCRnjh
            gwAr0AJLM4dE8iCwkfCDiW3SzaPZoC33Tybg7YrnYyE=
            -----END RSA PRIVATE KEY-----
        </div>
        <div id="publicKey" style="display:none;">
            -----BEGIN PUBLIC KEY-----
            MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDAsXrYoW/33Kb5+9dbKyAQot+j
            vFOe3h3bpg5QItZEfCACUHl6Koz0KBnjRMFYG+7F4jKRtJmq4xgIapXfdBLZ0xQT
            dZ3qIYSWJ7t51m62jkKAg7cv+g+sa/599Lk/xYclArZ+5TaJ8h3mbPrUCEv5w7FR
            38XxDQXlvY/q1r6t9QIDAQAB
            -----END PUBLIC KEY-----
        </div>
        <div id="cert" style="display:none;">
            -----BEGIN CERTIFICATE-----
            MIIDVjCCAr+gAwIBAgIIEy36qJOyFe8wDQYJKoZIhvcNAQELBQAwWTESMBAGA1UE
            BRMJMDg4ODg4ODhEMSIwIAYDVQQEExlUZXN0cy1Wb3RpbmdTeXN0ZW1TdXJuYW1l
            MR8wHQYDVQQqExZUZXN0cy1Wb3RpbmdTeXN0ZW1OYW1lMB4XDTE2MDMxNDE3MzIx
            N1oXDTE3MDMxNDE3MzIxN1owTzESMBAGA1UEBRMJMDg4ODg4ODhEMRswGQYDVQQE
            DBJsYXN0TmFtZV8wODg4ODg4OEQxHDAaBgNVBCoME0ZpcnN0TmFtZV8wODg4ODg4
            OEQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDR3UhK7InN9BWFtjF8
            Hi4U7JVN65u4AZtzlkBaGj44ebxqvXm5YZop0LjLp+bFiXiSxeIlOsDdhbWUocyN
            Wa4zG2/ReXWJX5HXEsBeip2Uj7eT7bcZW4q6f8L3qG82NZc803IVCC46t4QeegWC
            P+DWORfJfUHQzMeXuJiyvRHFPS3d0upnZoDg16mxQr323l8ic/Rm5S/vf5a98Shi
            CSIvxTBJaC8trt/ho5XeJV6xCAW6Va4JwvfLNx59IzlRWja8lYpvjvfeaQd72ba3
            5YcmvRrqWjpLsRSbyHLiLbISaoMoQQpMu5KAN+4kb6vWFXTN+7BMqncS8ccL9QdL
            GMjTAgMBAAGjgawwgakwagYDVR0jBGMwYYAUAzyinHiCaUTvEiUc3FGWviaysPmh
            P6Q9MDsxEjAQBgNVBAUTCTUwMDAwMDAwUjElMCMGA1UEAxMcVm90aW5nIFN5c3Rl
            bSBBY2Nlc3MgQ29udHJvbIIIVvvH5hBx5lYwHQYDVR0OBBYEFJo9/DpW+xRLVLKV
            AXnj6F968WCzMAwGA1UdEwEB/wQCMAAwDgYDVR0PAQH/BAQDAgWgMA0GCSqGSIb3
            DQEBCwUAA4GBAEPms+RkwVJBu+BeXPPnTKC9TiRV0kaOndomMACDHeSFCwB/c1/c
            B3Q2ZmcoM89Tgrp7tPGYaqFSl9WqwAmK8aE7gKhk5QXBpjy5G+Sw56XqnB7Tw+qL
            bofTOdmKMK1cwXzKXmiCtiAm5T5SFTEHwhAy2y3/rzF4n3vPILPftLjm
            -----END CERTIFICATE-----
        </div>
        <div id="encryptedCMSMsg" style="display:none;">
            -----BEGIN PKCS7-----
            MIAGCSqGSIb3DQEHA6CAMIACAQIxgZowgZcCAQKAADANBgkqhkiG9w0BAQEFAASB
            gCKtG5ZzA24pUhVagUHAvb/H8HYpHf76O2O+iXjELNqKQRdDzr7aDyAxR7JN2gaD
            pdryfSmX9+6754sN41lOFPN3TYFso5h0Y63TIzgLD2mMMcHWuu98qeGmB+BbuuEc
            DhKIWzxH3X5KTFnra7NiBLqtnzPifxLuSQBJk9gevdQ5MIAGCSqGSIb3DQEHATAd
            BglghkgBZQMEASoEEK3EzSkSUOo5uNS5Iu4wJEOggASBkGiGP3zJEoctrunVVzQV
            sr1TNbn2lEjD5J4ZO2LbidBADdakhgmq45rrowvmXmG0Q6sjZn8WSrpVjtcuw3V4
            ia1er35Ge5pLy4cBYZQSMSYsovmr+5I9lHMQw7c0X1p0MjMVWvyLPdQuepspzLe4
            DYkudhb+jJmWbWrS25bw2zg2bxolWZElKhU0ijOaqrhDfAAAAAAAAAAAAAA=
            -----END PKCS7-----
        </div>
        <div id="encryptedCMS1Msg" style="display:none;">
            -----BEGIN PKCS7-----
            MIAGCSqGSIb3DQEHA6CAMIACAQAxggGBMIIBfQIBADBlMFkxEjAQBgNVBAUTCTA4
            ODg4ODg4RDEiMCAGA1UEBBMZVGVzdHMtVm90aW5nU3lzdGVtU3VybmFtZTEfMB0G
            A1UEKhMWVGVzdHMtVm90aW5nU3lzdGVtTmFtZQIIEy36qJOyFe8wDQYJKoZIhvcN
            AQEBBQAEggEAXmVcepY0NfPI4oOHmsu+r2s3uak3NWcrzbQIwVHzLKSAYhCHpSlw
            v3Q5zfT9xFJYgAi/YIWdnBPYU1BPXEtVirXknGNZhtPO1LyhyZd1WgmRpnqSDzJo
            5KUstXYdirRAvCYarxT1yAJWOrr9ZL3rhGaxfR93U7BTsxYNX2IpwDKMhxWcHYG0
            sc630iHPJLY3okgz+QhfJe/6RovlmgCp0v9HdPkjt/JJynokIgDtLOQugid+iQ+D
            gJ2oVrYNqBWnMQxyNoyezcS0qMIVdg9xOg3wLLZkqnjUvGCb4gbeCmKwxy49rAp+
            ui1FNWkcRRRag0Av/KcM70aliXu8FknZqzCABgkqhkiG9w0BBwEwHQYJYIZIAWUD
            BAEqBBDt3M7RgwmvDSiaHK8GZ8jMoIAEELPHzrUKdL+UuN6gUIhhRYsAAAAAAAAA
            AAAA
            -----END PKCS7-----
        </div>
        <script>
            //<![CDATA[
            //encrypt aes256-CBC
            function testEncrypt() {
                var p7 = forge.pkcs7.createEnvelopedData();
                var cert = forge.pki.certificateFromPem(document.querySelector("#cert").innerHTML);
                p7.addRecipient(cert);
                p7.content = forge.util.createBuffer('Just a little test');
                p7.encrypt();
                var pem = forge.pkcs7.messageToPem(p7);
                console.log("Encrypted:")
                console.log(pem)
                var privateKey = forge.pki.privateKeyFromPem(document.querySelector("#privateKey").innerHTML);
                p7 = forge.pkcs7.messageFromPem(pem);
                p7.decrypt(p7.recipients[0], privateKey);
                console.log("Decrypted:")
                console.log(p7)
            }

            function testDecrypt() {
                console.log("testDecrypt")
                var encryptedCMSMsg = forge.pkcs7.messageFromPem(document.querySelector("#encryptedCMSMsg").innerHTML);
                var privateKey = forge.pki.privateKeyFromPem(document.querySelector("#privateKey").innerHTML);
                console.log("privateKey:")
                console.log(privateKey)
                console.log("encryptedCMSMsg:")
                console.log(encryptedCMSMsg)
                encryptedCMSMsg.decrypt(encryptedCMSMsg.recipients[0], privateKey);
                console.log("encryptedCMSMsg:")
                console.log(encryptedCMSMsg)
            }

            window.addEventListener('WebComponentsReady', function() {
                testDecrypt();
            })
            //]]>
        </script>
    </ui:define>
</ui:composition>