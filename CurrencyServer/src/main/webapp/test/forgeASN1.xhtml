<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/WEB-INF/templates/polymer.xhtml">
    <ui:define name="head">
        <link href="../resources/forgePKCS7.html" rel="import"/>
        <script type="text/javascript" src="./ForgeUtils.js"></script>
        <style></style>
    </ui:define>
    <ui:define name="content">
        <h3><div id="selectedMsgDiv"></div></h3>
        <div id="oids"></div>
        <div id="timeStampedCMSMessage" style="display:none;">
            -----BEGIN PKCS7-----
            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
            Gy1Z5MmgnHziu2dKE51tofWQAAAAAAAA
            -----END PKCS7-----
        </div>
        <div id="cmsMessage" style="display:none;">
            -----BEGIN PKCS7-----
            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
            -----END PKCS7-----
        </div>

        <script>
            //<![CDATA[
            var selectedMsg = "timeStampedCMSMessage"
            document.querySelector("#selectedMsgDiv").innerHTML = selectedMsg

            var oids = forge.pki.oids;
            document.querySelector("#oids").innerHTML = JSON.stringify(oids)

            var cmsMessage = forge.pkcs7.messageFromPem(document.querySelector("#" + selectedMsg).innerHTML);
            console.log("cmsMessage:")
            console.log(cmsMessage)
            console.log(forge.pkcs7asn1.signedDataValidator)


            var authenticatedAttributes = cmsMessage.rawCapture.authenticatedAttributes;
            console.log("authenticatedAttributes:")
            console.log(authenticatedAttributes)

            var signature = cmsMessage.rawCapture.signature;
            console.log("signature:")
            console.log(signature)

            var attrs = []
            var asn1Set = forge.asn1.create(forge.asn1.Class.UNIVERSAL, forge.asn1.Type.SET, true, attrs); // packed them inside of the SET object
            console.log("asn1 set:")
            console.log(asn1Set)

            //var buf = new Buffer(asn1.toDer(set).data, 'binary'); // DO NOT forget 'binary', otherwise it tries to interpret bytes as UTF-8 chars
            var buf = forge.util.createBuffer(forge.asn1.toDer(asn1Set).data, 'binary')
            console.log("buf:")
            console.log(buf)

            var attrDigest = null;
            for (var i = 0; i < authenticatedAttributes.length; ++i) {
                var authenticatedAttribute = authenticatedAttributes[i].value;
                console.log("authenticatedAttribute oid:" + forge.asn1.derToOid(authenticatedAttribute[0].value))
                if (forge.asn1.derToOid(authenticatedAttribute[0].value) === oids.messageDigest) {
                    attrDigest = authenticatedAttribute[1].value[0].value;
                }
            }
            console.log("attrDigest:")
            console.log(attrDigest)

            //]]>
        </script>
    </ui:define>
</ui:composition>