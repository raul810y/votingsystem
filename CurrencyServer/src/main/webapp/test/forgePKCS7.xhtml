<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/WEB-INF/templates/polymer.xhtml">
    <ui:define name="head">
        <link href="../resources/forgePKCS7.html" rel="import"/>
        <script type="text/javascript" src="./ForgeUtils.js"></script>
        <script type="text/javascript" src="./TestUtils.js"></script>
        <style></style>
    </ui:define>
    <ui:define name="content">
        <div id="cmsMessage" style="display:none;">
            -----BEGIN PKCS7-----
            MIAGCSqGSIb3DQEHAqCAMIACAQExDzANBglghkgBZQMEAgEFADCABgkqhkiG9w0B
            BwGggCSABBVIZWxsbyBUaW1lU3RhbXBTaWduZWQAAAAAAACggDCCA1YwggK/oAMC
            AQICCHZc3chVPidLMA0GCSqGSIb3DQEBCwUAMFkxEjAQBgNVBAUTCTA4ODg4ODg4
            RDEiMCAGA1UEBBMZVGVzdHMtVm90aW5nU3lzdGVtU3VybmFtZTEfMB0GA1UEKhMW
            VGVzdHMtVm90aW5nU3lzdGVtTmFtZTAeFw0xNjAzMTMxODEzMTNaFw0xNzAzMTMx
            ODEzMTNaME8xEjAQBgNVBAUTCTA4ODg4ODg4RDEbMBkGA1UEBAwSbGFzdE5hbWVf
            MDg4ODg4ODhEMRwwGgYDVQQqDBNGaXJzdE5hbWVfMDg4ODg4ODhEMIIBIjANBgkq
            hkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA8rr9rHfkTrK1+h2FTw8d+3i31dNL1LrY
            qN6rfojqOs/d2iE4uq87ecgEQdDD9E6EXg/zibRNyy9TXvV4Rit+J/iv7qaxQyvR
            K3aMC68Defpn4Katpef1SI19Mg9524991LL0p+OnmXi7IJGz3vFcMP6RofGvqJaD
            57XRYpj2fK8Ed2snjNUaTDEji4rjfPEkWV5XsB+eoCNX4kewWX4qxu6womGjx3+a
            bC/hYdZ4opVLxMIUIrx78/HHg/I5WrJo6wFt/9FWrI97ixb6w8etWf1NtADSqbcL
            lxM788DckkFNjX35niPZqTfyGTg4KmP2LSJ8ILT9ytYDmB0duDKqUQIDAQABo4Gs
            MIGpMGoGA1UdIwRjMGGAFAM8opx4gmlE7xIlHNxRlr4msrD5oT+kPTA7MRIwEAYD
            VQQFEwk1MDAwMDAwMFIxJTAjBgNVBAMTHFZvdGluZyBTeXN0ZW0gQWNjZXNzIENv
            bnRyb2yCCFb7x+YQceZWMB0GA1UdDgQWBBQ55lJXRmFFAa85nQobLgqyzPK8DDAM
            BgNVHRMBAf8EAjAAMA4GA1UdDwEB/wQEAwIFoDANBgkqhkiG9w0BAQsFAAOBgQAN
            VxjhnrfoGYKhWMLs2ZwL8JsmPcxinOQKwml8/9MZYfBOXN5lMlibqWyE9qaJ4/NX
            uVAubttGRtKD5cZvbL2C7tCCd7W2KGs3JZEC3DHhXeBDvjBpvaEWrG3MH//ci19b
            G86TshaIC8C7M5rLyxCkzJIxzZcMRj9fI3fKCm32tDCCAsEwggIqoAMCAQICCFb7
            x+YQceZWMA0GCSqGSIb3DQEBBQUAMDsxEjAQBgNVBAUTCTUwMDAwMDAwUjElMCMG
            A1UEAxMcVm90aW5nIFN5c3RlbSBBY2Nlc3MgQ29udHJvbDAeFw0xNDEyMDExMjIw
            NTdaFw0xNTExMzAyMzAwMDBaMFkxEjAQBgNVBAUTCTA4ODg4ODg4RDEiMCAGA1UE
            BBMZVGVzdHMtVm90aW5nU3lzdGVtU3VybmFtZTEfMB0GA1UEKhMWVGVzdHMtVm90
            aW5nU3lzdGVtTmFtZTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAgimbCUSy
            KHJh1eOqgpx8Mz2UZsxtntin2Pkxo/nEiaviyXduU+dOS5i7LodHmEkxD1KO0Cc2
            Q0rRlFSxBJaasDwgjTD64bOAt925slNvS1Hcu4IJ+WQr7S7XRl5GlQTjcBtBSLzQ
            hiZePjt9M4kW0hnPgt0HXN77vLL+XVcVx9cCAwEAAaOBrzCBrDBtBgNVHSMEZjBk
            gBR5ZuroHheWMR8LG5r7uBquVdW+WaFCpEAwPjEsMCoGA1UEAwwjVm90aW5nIFN5
            c3RlbSBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkxDjAMBgNVBAsMBUNlcnRzgggkPrWq
            aEVFoTAdBgNVHQ4EFgQUAzyinHiCaUTvEiUc3FGWviaysPkwDAYDVR0TAQH/BAIw
            ADAOBgNVHQ8BAf8EBAMCBaAwDQYJKoZIhvcNAQEFBQADgYEACV/OVgQkaGuh0fNl
            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
            -----END PKCS7-----
        </div>

        <script>

            function readPKCS7Message() {
                var cmsMessagePEM = document.querySelector("#cmsMessage").innerHTML;
                var cmsSignedMessage = forge.pkcs7.messageFromPem(cmsMessagePEM);
                console.log(cmsSignedMessage)
            }

            function createPKCS7MessageTimeStamped() {
                var certPrivateKeyPair = test.createSelfSignedCert();
                var contentToSign = "Hello signed and TimeStamped message"
                vs.getTimeStampToken(contentToSign, function (timeStampTokenASN1) {
                    console.log(timeStampTokenASN1)
                    var cmsSignedMessage =  test.createCMSSignedMessage(certPrivateKeyPair, contentToSign, timeStampTokenASN1)
                    console.log(cmsSignedMessage)
                    var pem = forge.pkcs7.messageToPem(cmsSignedMessage);
                    console.log("--------- timeStamped PKCS7Message:")
                    console.log(pem)
                    var p7 = forge.pkcs7.messageFromPem(pem);
                    console.log(p7)
                })
            }

            function createPKCS7Message() {
                var certPrivateKeyPair = test.createSelfSignedCert();
                var cmsSignedMessage =  test.createCMSSignedMessage(certPrivateKeyPair, 'Some content to be signed.')
                console.log(cmsSignedMessage)
                var pem = forge.pkcs7.messageToPem(cmsSignedMessage);
                var p7 = forge.pkcs7.messageFromPem(pem);
                console.log(p7)
            }

            //readPKCS7Message()
            createPKCS7MessageTimeStamped()

        </script>
    </ui:define>
</ui:composition>