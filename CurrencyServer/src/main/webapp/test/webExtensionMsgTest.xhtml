<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/WEB-INF/templates/polymer.xhtml">
    <ui:define name="head">
    </ui:define>
    <ui:define name="content">
        <button onclick="sendExternalMessageToExtension()">sendMessageToExtension</button>
        <button onclick="sendMessageToExtensionWithContentScript()">sendMessageToExtensionWithContentScript</button>

        <script>
            //<![CDATA[
            debugger; // this is to allow logging from extension content scripts
            // The ID of the extension we want to talk to.
            var editorExtensionId = "knldjmfmopnpolahpmmgbagdohdnhkik";

            /**
             The manifest.json of the extension must have the property:
             "externally_connectable": {
                "matches": ["*://*.votingsystem.org/*"]
             }
             **/
            function sendExternalMessageToExtension() {
                chrome.runtime.sendMessage(editorExtensionId, {operation: "connect-native"},
                    function(response) {
                        if (!response) console.log("runtime - sendMessage fail: " + response)
                    });
            }

            /**
             "content_scripts": [ {
             "matches": [all urls],
                "js": ["content.js"]
                }],
             **/
            function sendMessageToExtensionWithContentScript() {
                window.postMessage({ operation: "connect-native-message", message_type: "message_to_extension" }, "*");
            }

            window.addEventListener("message", function(event) {
                if (event.source != window) return;
                if (event.data.operation && event.data.message_type === 'message_from_extension') {
                    console.log("webExtensionMsgTest - Content script received: " + JSON.stringify(event.data));
                }
            }, false)
            // ]]>
        </script>
    </ui:define>
</ui:composition>
