<html>
<script src="./bower_components/visionmedia-page/page.js"></script>
<script>
  window.addEventListener('WebComponentsReady', function() {

      var contactPage
      page('*/app/contact', function (ctx) {
          vs.route = 'contact';
          Polymer.Base.importHref('./app/contact-page.vsp', function(e) {
              if(!contactPage) contactPage = document.createElement('contact-page');
              vs.loadMainContent(contactPage, "${msg.contactLbl}")
          });
      });

      var pageMap = {}
      page('*/innerVSPage*', function(ctx) {
          var route = getQueryParam('data_route', ctx.querystring)
          if(route) vs.route = route
          var url = vs.contextURL + getQueryParam('url', ctx.querystring)
          var pageCaption = getQueryParam('caption', ctx.querystring)
          console.log("innerVSPage - url: " + url + " - caption: " + pageCaption)
          if(pageMap[url]) vs.loadMainContent(pageMap[url], pageCaption)
          else {
              Polymer.Base.importHref(url, function(e) {
                  pageMap[url] = e.target.import.body
                  vs.loadMainContent(pageMap[url], pageCaption)
              });
          }
      });

      var toolsPage
      page('*/app/tools', function (ctx) {
          vs.route = 'tools';
          Polymer.Base.importHref('./app/tools-page.vsp', function(e) {
              if(!toolsPage) toolsPage = document.createElement('tools-page');
              vs.loadMainContent(toolsPage, "${msg.toolsPageTitle}")
          });
      });

      var transactionsDashboard
      page('*/transactionsDashboard*', function() {
          vs.route = 'transactionsDashboard';
          Polymer.Base.importHref('./transDashboard/transactions-dashboard.vsp', function(e) {
              if(!transactionsDashboard) transactionsDashboard = document.createElement('transactions-dashboard');
              vs.loadMainContent(transactionsDashboard, "${msg.dashBoardLbl}")
          });
      });

      var certificateList
      page('*/x509Certificate/certs', function() {
          vs.route = 'x509Certificate';
          Polymer.Base.importHref('./x509Certificate/cert-list.vsp', function(e) {
              if(!certificateList) certificateList = document.createElement('cert-list');
              vs.loadMainContent(certificateList, "${msg.certsPageTitle}")
          });
      });

      var currencyIssued
      page('*/currencyIssued*', function(ctx) {
          vs.route = 'reports';
          Polymer.Base.importHref('./currency/currency-issued.vsp', function(e) {
              if(!currencyIssued) currencyIssued = document.createElement('currency-issued');
              currencyIssued.currencyCode = getQueryParam('currencyCode', ctx.querystring)
              vs.loadMainContent(currencyIssued, "${msg.currencyIssued}")
          });
      });

      var currencyRequest
      page('*/currency/request', function(data) {
          vs.route = 'currencyRequest';
          Polymer.Base.importHref('./currency/currency-request-form.vsp', function(e) {
              if(!currencyRequest) currencyRequest = document.createElement('currency-request-form');
              vs.loadMainContent(currencyRequest, "${msg.doCurrencyRequestLbl}")
          });
      });

      var currencyAccountSystem
      page('*/currencyAccount/system', function(data) {
          vs.route = 'reports';
          Polymer.Base.importHref('./currencyAccount/system-accounts.vsp', function(e) {
              if(!currencyAccountSystem) currencyAccountSystem = document.createElement('system-accounts');
              vs.loadMainContent(currencyAccountSystem, "${msg.systemBalanceLbl}")
          });
      });

      var groupEditor
      page('/group_editor', function (ctx) {
          vs.route = 'group_editor';
          Polymer.Base.importHref('./group/group-editor.vsp', function () {
              if (!groupEditor) groupEditor = document.createElement('group-editor');
              vs.loadMainContent(groupEditor, "${msg.newGroupLbl}")
          });
      });

      var groupList
      page('*/group', function() {
          vs.route = 'group';
          Polymer.Base.importHref('./group/group-list.vsp', function(e) {
              if(!groupList) {
                  groupList = document.createElement('group-list');
              }
              vs.loadMainContent(groupList, "${msg.groupLbl}", true)
          });
      });

      var groupUser
      page('*/rest/group/id/*/user/id/*', function(data) {
          vs.route = 'group';
          console.log("routing.xhtml - TODO - groupUser - display with group-user - data.path: " + data.path)
      });

      var groupDetailsPage
      page('*/rest/group/id/*', function(data) {
          vs.route = 'group';
          Polymer.Base.importHref('./group/group-details.vsp', function(e) {
              if(!groupDetailsPage) groupDetailsPage = document.createElement('group-details');
              if(vs.group) groupDetailsPage.group = vs.group
              else groupDetailsPage.url = data.path
              vs.loadMainContent(groupDetailsPage, "${msg.groupLbl}", false)
          });
      });

      var cmsMessageViewer
      page('*/cmsMessagePEM/id*', function(data) {
          vs.route = 'userDashboard';
          Polymer.Base.importHref('./cmsMessagePEM/message-cms-viewer.vsp', function(e) {
              if(!cmsMessageViewer) cmsMessageViewer = document.createElement('message-cms-viewer');
              cmsMessageViewer.url = data.path
              vs.loadMainContent(cmsMessageViewer)
          });
      });

      page('*/newGroup', function() {
          vs.route = 'newGroup';
          VotingSystemClient.setMessage(new OperationVS(Operation.CURRENCY_GROUP_NEW))
      });

      var reports
      page('*/reports', function(data) {
          vs.route = 'reports';
          Polymer.Base.importHref('./reports/vs-reports.vsp', function(e) {
              if(!reports) reports = document.createElement('vs-reports');
              vs.loadMainContent(reports)
          });
      });

      var weekReports
      page('*/reports/*/week', function(data) {
          vs.route = 'reports';
          Polymer.Base.importHref('./reports/week-reports.vsp', function(e) {
              if(!weekReports) weekReports = document.createElement('week-reports');
              weekReports.url = data.path
              vs.loadMainContent(weekReports)
          });
      });

      var user
      page('*/rest/user/id/*', function(data) {
          vs.route = 'user';
          Polymer.Base.importHref('./user/user-data.vsp', function(e) {
              if(!user) user = document.createElement('user-data');
              user.url = data.path
              vs.loadMainContent(user)
          });
      });

      var userBalance
      page('*/rest/balance/user/id/*', function(data) {
          vs.route = 'user';
          Polymer.Base.importHref('./balance/balance-user.vsp', function(e) {
              if(!userBalance) userBalance = document.createElement('balance-user');
              userBalance.url = data.path
              vs.loadMainContent(userBalance, "${msg.balanceLbl}")
          });
      });

      page('/rest/balance/user/nif/:nif', function(ctx) {
          vs.route = 'user';
          Polymer.Base.importHref('./balance/balance-user.vsp', function(e) {
              if(!userBalance) userBalance = document.createElement('balance-user');
              userBalance.url = vs.contextURL + "/rest/balance/user/nif/" +  ctx.params.nif
              vs.loadMainContent(userBalance, "${msg.balanceLbl}")
          });
      });

      var transactionList
      page('*/transaction/from*', function(data) {
          vs.route = 'userDashboard';
          Polymer.Base.importHref('./transaction/transaction-list.vsp', function(e) {
              if(!transactionList) transactionList = document.createElement('transaction-list');
              transactionList.url = data.path
              vs.loadMainContent(transactionList, "${msg.transactionsLbl}")
          });
      });

      var bankList
      page('*/user/bankList', function(data) {
          vs.route = 'reports';
          Polymer.Base.importHref('./user/bank-list.vsp', function(e) {
              if(!bankList) bankList = document.createElement('bank-list');
              vs.loadMainContent(bankList, "${msg.bankListLbl}")
          });
      });

      var userViewer
      page('*/user/IBAN/*', function(data) {
          vs.route = 'reports';
          Polymer.Base.importHref('./user/user-viewer.vsp', function(e) {
              if(!userViewer) userViewer = document.createElement('user-viewer');
              userViewer.url = data.path
              vs.loadMainContent(userViewer)
          });
      });

      var userSelector
      page('*/user/search*', function(data) {
          vs.route = 'user';
          Polymer.Base.importHref('./user/user-selector.vsp', function(e) {
              if(!userSelector) userSelector = document.createElement('user-selector');
              vs.loadMainContent(userSelector, "${msg.userSearchPageTitle}")
          });
      });

      page({
          hashbang: true // add #! before urls
      });

      if(!vs.route) page("/group")
  });
</script>
</html>